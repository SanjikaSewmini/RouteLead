{
  "info": {
    "name": "RouteLead Complete API Collection - With Route CRUD Operations",
    "description": "üöÄ **RouteLead Complete API Collection** - Full CRUD + Advanced Testing\n\n**üìã SETUP INSTRUCTIONS:**\n1. Import this collection into Postman\n2. Ensure Spring Boot app is running on http://localhost:8080\n3. Collection variables are pre-configured with real database IDs\n4. If requests fail, check that the Spring Boot application is running\n\n**üîß ROUTE OPERATIONS:**\n‚úÖ CREATE: POST /api/routes\n‚úÖ READ: GET /api/routes/:routeId  \n‚úÖ UPDATE: PATCH /api/routes/:routeId (‚≠ê Enhanced with multiple test scenarios)\n‚úÖ DELETE: DELETE /api/routes/:routeId\n\n**üèÜ PATCH ROUTE Features:**\n‚Ä¢ Complete field updates (coordinates, pricing, schedule, status)\n‚Ä¢ Partial updates (update only specific fields)\n‚Ä¢ Status-only updates (OPEN‚ÜíBOOKED‚ÜíCOMPLETED)\n‚Ä¢ Pricing adjustments (Sri Lankan LKR amounts)\n‚Ä¢ Schedule modifications (Sri Lanka timezone)\n‚Ä¢ Location updates (real Sri Lankan coordinates)\n‚Ä¢ Validation testing (business rule enforcement)\n\n**üë®‚ÄçÔøΩ DRIVER OPERATIONS:**\n‚úÖ GET /api/driver/routes (with status filtering)\n‚úÖ GET /api/driver/bids/history (with status filtering)\n\n**ÔøΩüó∫Ô∏è Sri Lankan Data:**\n‚Ä¢ Real coordinates for major cities\n‚Ä¢ LKR pricing for local market\n‚Ä¢ UTC+05:30 timezone handling\n‚Ä¢ Authentic route scenarios\n\n**üß™ Test Coverage:**\n‚Ä¢ Driver bid history with status filtering\n‚Ä¢ Route filtering by status (OPEN, BOOKED, COMPLETED, CANCELLED)\n‚Ä¢ Business rule validation\n‚Ä¢ Error handling scenarios\n‚Ä¢ Real database IDs pre-configured\n\n**üîç TROUBLESHOOTING:**\n‚Ä¢ Ensure Spring Boot app is running on port 8080\n‚Ä¢ Collection variables contain real database IDs\n‚Ä¢ Check console logs for detailed error messages\n‚Ä¢ Use terminal commands to verify API functionality",
    "version": "3.0.0",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "üîç Quick Tests",
      "item": [
        {
          "name": "0. Health Check",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/home",
              "host": ["{{baseUrl}}"],
              "path": ["home"]
            },
            "description": "ü©∫ **Health Check** - Verify API connectivity\n\nUse this endpoint first to ensure:\n1. Spring Boot application is running\n2. Port 8080 is accessible\n3. Basic API response is working\n\n**Expected Response:** Welcome message or basic API info"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Health check test",
                  "pm.test(\"API is accessible\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response time is acceptable\", function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(5000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "0.1. Test Driver Routes (Quick)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/driver/routes?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "driver", "routes"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID"}
              ]
            },
            "description": "üöÄ **Quick Test** - Driver Routes\n\nTest the driver routes endpoint with real data to verify:\n1. Database connectivity\n2. Driver routes functionality\n3. Collection variables are working\n\n**Uses Real Data:** Driver ID from collection variables"
          }
        },
        {
          "name": "0.2. Test Bid History (Quick)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/driver/bids/history?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "driver", "bids", "history"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID"}
              ]
            },
            "description": "üìä **Quick Test** - Driver Bid History\n\nTest the bid history endpoint to verify:\n1. Database relationships are working\n2. Bid data is accessible\n3. Customer information is properly joined\n\n**Uses Real Data:** Driver ID with actual bid history"
          }
        }
      ]
    },
    {
      "name": "Authentication",
      "item": [
        {
          "name": "1. Signup",
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"newuser@routelead.com\",\n  \"password\": \"password123\",\n  \"name\": \"Test User\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/signup",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "signup"]
            }
          }
        },
        {
          "name": "2. Login",
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"newuser@routelead.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        }
      ]
    },
    {
      "name": "Routes",
      "item": [
        {
          "name": "3. Create Route",
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"driverId\": \"{{driverId}}\",\n  \"originLat\": 6.9271,\n  \"originLng\": 79.8612,\n  \"destinationLat\": 7.2906,\n  \"destinationLng\": 80.6337,\n  \"departureTime\": \"2025-07-05T10:00:00+05:30\",\n  \"detourToleranceKm\": 5.0,\n  \"suggestedPriceMin\": 2500.00,\n  \"suggestedPriceMax\": 4000.00\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/routes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes"]
            },
            "description": "Create a new route with all details. Returns the created route with ID."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test script to save route ID for other requests",
                  "if (pm.response.code === 201) {",
                  "    const responseJson = pm.response.json();",
                  "    if (responseJson.id) {",
                  "        pm.collectionVariables.set('routeId', responseJson.id);",
                  "        console.log('Route ID saved: ' + responseJson.id);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "4. Get Route Directions (Colombo to Kandy)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/routes/directions?originLat=6.9271&originLng=79.8612&destLat=7.2906&destLng=80.6337",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "directions"],
              "query": [
                {"key": "originLat", "value": "6.9271", "description": "Colombo latitude"},
                {"key": "originLng", "value": "79.8612", "description": "Colombo longitude"},
                {"key": "destLat", "value": "7.2906", "description": "Kandy latitude"},
                {"key": "destLng", "value": "80.6337", "description": "Kandy longitude"}
              ]
            }
          }
        },
        {
          "name": "5. Get Route by ID",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/routes/{{routeId}}?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "{{routeId}}"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID for authorization"}
              ]
            },
            "description": "Get a specific route by ID. Requires driverId for authorization to ensure only the route owner can view detailed information."
          }
        },
        {
          "name": "5.1. Update Route (PATCH) - Full Update",
          "request": {
            "method": "PATCH",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"originLat\": 6.9271,\n  \"originLng\": 79.8612,\n  \"destinationLat\": 7.2906,\n  \"destinationLng\": 80.6337,\n  \"departureTime\": \"2025-07-06T14:30:00+05:30\",\n  \"detourToleranceKm\": 8.0,\n  \"suggestedPriceMin\": 3000.00,\n  \"suggestedPriceMax\": 4500.00,\n  \"status\": \"OPEN\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/routes/{{routeId}}?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "{{routeId}}"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID for authorization"}
              ]
            },
            "description": "‚úÖ **PATCH Route - Full Update**\n\nUpdate multiple fields in an existing route. All fields are optional - only provided fields will be updated.\n\n**Use cases:**\n1. Change route locations (originLat/Lng, destinationLat/Lng)\n2. Update departure time\n3. Modify detour tolerance\n4. Adjust price range\n5. Change route status (OPEN, BOOKED, COMPLETED, CANCELLED)\n\n**Business Rules:**\n- Only the route owner (driver) can update\n- Status transitions must be valid (e.g., OPEN ‚Üí BOOKED ‚Üí COMPLETED)\n- Price ranges must be positive\n- Departure time must be in future\n\n**Response:** Updated route object with timestamp"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test script for PATCH route",
                  "pm.test(\"Status code should be 200 for successful update\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response should contain updated route\", function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('id');",
                  "    pm.expect(responseJson).to.have.property('status');",
                  "    pm.expect(responseJson).to.have.property('updatedAt');",
                  "});",
                  "",
                  "pm.test(\"Updated fields should match request\", function () {",
                  "    const responseJson = pm.response.json();",
                  "    const requestJson = JSON.parse(pm.request.body.raw);",
                  "    ",
                  "    if (requestJson.status) {",
                  "        pm.expect(responseJson.status).to.eql(requestJson.status);",
                  "    }",
                  "    if (requestJson.suggestedPriceMin) {",
                  "        pm.expect(responseJson.suggestedPriceMin).to.eql(requestJson.suggestedPriceMin);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "5.2. Update Route (PATCH) - Status Only",
          "request": {
            "method": "PATCH",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"BOOKED\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/routes/{{routeId}}?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "{{routeId}}"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID for authorization"}
              ]
            },
            "description": "‚úÖ **PATCH Route - Status Only Update**\n\nUpdate only the route status when a customer books the route.\n\n**Valid Status Transitions:**\n- OPEN ‚Üí BOOKED (customer books route)\n- BOOKED ‚Üí COMPLETED (delivery finished)\n- OPEN ‚Üí CANCELLED (driver cancels)\n- BOOKED ‚Üí CANCELLED (mutual agreement)\n\n**Example:** Route status changes from OPEN to BOOKED when customer confirms booking."
          }
        },
        {
          "name": "5.3. Update Route (PATCH) - Pricing Only",
          "request": {
            "method": "PATCH",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"suggestedPriceMin\": 2800.00,\n  \"suggestedPriceMax\": 4200.00\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/routes/{{routeId}}?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "{{routeId}}"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID for authorization"}
              ]
            },
            "description": "‚úÖ **PATCH Route - Pricing Only Update**\n\nDriver adjusts pricing based on market demand, fuel costs, or competitive analysis.\n\n**Validation Rules:**\n- Both prices must be positive\n- suggestedPriceMin must be ‚â§ suggestedPriceMax\n- Prices in Sri Lankan Rupees (LKR)\n\n**Use Cases:**\n- Market demand increases ‚Üí raise prices\n- Competition analysis ‚Üí adjust competitive pricing\n- Fuel cost changes ‚Üí reflect in pricing"
          }
        },
        {
          "name": "5.4. Update Route (PATCH) - Schedule Only",
          "request": {
            "method": "PATCH",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"departureTime\": \"2025-07-06T16:00:00+05:30\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/routes/{{routeId}}?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "{{routeId}}"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID for authorization"}
              ]
            },
            "description": "‚úÖ **PATCH Route - Schedule Only Update**\n\nDriver changes departure time due to schedule adjustments, traffic considerations, or customer requests.\n\n**Validation Rules:**\n- Departure time must be in the future\n- Must be in Sri Lanka timezone (UTC+05:30)\n- Format: ISO 8601 with timezone\n\n**Use Cases:**\n- Traffic conditions change\n- Driver schedule conflicts\n- Customer timing preferences\n- Weather considerations"
          }
        },
        {
          "name": "5.5. Update Route (PATCH) - Coordinates Only",
          "request": {
            "method": "PATCH",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"originLat\": 6.9319,\n  \"originLng\": 79.8478,\n  \"destinationLat\": 7.2966,\n  \"destinationLng\": 80.6350\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/routes/{{routeId}}?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "{{routeId}}"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID for authorization"}
              ]
            },
            "description": "‚úÖ **PATCH Route - Coordinates Only Update**\n\nUpdate pickup/dropoff locations with precise coordinates for better route optimization.\n\n**Sri Lankan Coordinates Used:**\n- Origin: Fort Railway Station, Colombo (6.9319, 79.8478)\n- Destination: Kandy City Center (7.2966, 80.6350)\n\n**Validation Rules:**\n- Latitude: -90 to 90 degrees\n- Longitude: -180 to 180 degrees\n- Sri Lanka bounds: Lat 5.9-9.9, Lng 79.6-81.9\n\n**Use Cases:**\n- More precise pickup/dropoff points\n- Route optimization\n- Customer location updates"
          }
        },
        {
          "name": "5.6. Update Route (PATCH) - Validation Error Test",
          "request": {
            "method": "PATCH",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"suggestedPriceMin\": 5000.00,\n  \"suggestedPriceMax\": 3000.00,\n  \"status\": \"INVALID_STATUS\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/routes/{{routeId}}?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "{{routeId}}"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID for authorization"}
              ]
            },
            "description": "‚ùå **PATCH Route - Validation Error Test**\n\nThis request intentionally contains invalid data to test validation:\n\n**Expected Errors:**\n1. `suggestedPriceMin` (5000) > `suggestedPriceMax` (3000)\n2. Invalid status value \"INVALID_STATUS\"\n\n**Expected Response:** 400 Bad Request with validation error details\n\n**Valid Status Values:** OPEN, BOOKED, COMPLETED, CANCELLED"
          }
        },
        {
          "name": "5.7. Delete Route",
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{baseUrl}}/api/routes/{{routeId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "{{routeId}}"]
            },
            "description": "Delete a route by ID. Business rules:\n1. Only routes with status OPEN or CANCELLED can be deleted\n2. Routes with status BOOKED or COMPLETED cannot be deleted\n3. Associated route segments will be automatically deleted (cascade)\n4. Any related bids or price predictions will also be affected\n\nReplace {{routeId}} with actual route ID from create route response.\n\nResponse Codes:\n- 200 OK: Route deleted successfully\n- 400 Bad Request: Route cannot be deleted (wrong status)\n- 404 Not Found: Route not found\n- 500 Internal Server Error: Server error"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test script for delete route",
                  "pm.test(\"Status code should be 200 for successful deletion\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response should contain success message\", function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('message');",
                  "    pm.expect(responseJson.message).to.include('deleted successfully');",
                  "});",
                  "",
                  "pm.test(\"Response should contain route ID\", function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('routeId');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "5.8. Delete Route - Invalid Status Test",
          "request": {
            "method": "DELETE",
            "url": {
              "raw": "{{baseUrl}}/api/routes/{{routeId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "{{routeId}}"]
            },
            "description": "Test case to verify that routes with BOOKED or COMPLETED status cannot be deleted.\n\nFirst update the route status to BOOKED using the update endpoint (5.2), then try to delete it.\nThis should return a 400 Bad Request error.\n\nSteps to test:\n1. Create a route\n2. Update route status to BOOKED\n3. Try to delete the route (should fail)\n4. Update route status back to OPEN\n5. Delete the route (should succeed)"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test script for delete route with invalid status",
                  "pm.test(\"Should return 400 Bad Request for BOOKED/COMPLETED routes\", function () {",
                  "    pm.response.to.have.status(400);",
                  "});",
                  "",
                  "pm.test(\"Error message should mention status restriction\", function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('message');",
                  "    pm.expect(responseJson.message).to.include('Cannot delete route with status');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "6. Get Route Segments",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/routes/segments?routeId={{routeId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "segments"],
              "query": [
                {"key": "routeId", "value": "{{routeId}}", "description": "Route ID from create route response"}
              ]
            }
          }
        },
        {
          "name": "7. Get Price Suggestion",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/routes/price-suggestion?routeId={{routeId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "price-suggestion"],
              "query": [
                {"key": "routeId", "value": "{{routeId}}", "description": "Route ID from create route response"}
              ]
            }
          }
        },
        {
          "name": "8. Break Polyline into Segments",
          "request": {
            "method": "POST",
            "url": {
              "raw": "{{baseUrl}}/api/routes/break-polyline?polyline=u{~vFvyys@fS]&segmentDistanceKm=5.0",
              "host": ["{{baseUrl}}"],
              "path": ["api", "routes", "break-polyline"],
              "query": [
                {"key": "polyline", "value": "u{~vFvyys@fS]", "description": "Encoded polyline string"},
                {"key": "segmentDistanceKm", "value": "5.0", "description": "Distance between segments in km"}
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Driver Routes",
      "item": [
        {
          "name": "9. Get Driver Routes - All",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/driver/routes?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "driver", "routes"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID"}
              ]
            },
            "description": "Get all routes for a specific driver regardless of status"
          }
        },
        {
          "name": "10. Get Driver Routes - By Status",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/driver/routes?driverId={{driverId}}&status=OPEN",
              "host": ["{{baseUrl}}"],
              "path": ["api", "driver", "routes"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID"},
                {"key": "status", "value": "OPEN", "description": "Filter by route status (OPEN, BOOKED, COMPLETED, CANCELLED)"}
              ]
            },
            "description": "Get only OPEN routes for a specific driver"
          }
        },
        {
          "name": "11. Get Driver Bid History - All",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/driver/bids/history?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "driver", "bids", "history"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID"}
              ]
            },
            "description": "Get all bid history for a specific driver including parcel request details and customer information"
          }
        },
        {
          "name": "12. Get Driver Bid History - By Status",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/driver/bids/history?driverId={{driverId}}&status=PENDING",
              "host": ["{{baseUrl}}"],
              "path": ["api", "driver", "bids", "history"],
              "query": [
                {"key": "driverId", "value": "{{driverId}}", "description": "Driver UUID"},
                {"key": "status", "value": "PENDING", "description": "Filter by bid status (PENDING, ACCEPTED, REJECTED)"}
              ]
            },
            "description": "Get bid history for a specific driver filtered by status. Available statuses: PENDING, ACCEPTED, REJECTED"
          }
        }
      ]
    },
    {
      "name": "Vehicles",
      "item": [
        {
          "name": "13. Get All Vehicles",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/vehicles",
              "host": ["{{baseUrl}}"],
              "path": ["api", "vehicles"]
            }
          }
        },
        {
          "name": "14. Get Vehicles by Driver",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/vehicles/driver/{{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "vehicles", "driver", "{{driverId}}"]
            },
            "description": "Get vehicles for the driver ID"
          }
        },
        {
          "name": "15. Create Vehicle",
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"driverId\": \"{{driverId}}\",\n  \"color\": \"Blue\",\n  \"make\": \"Toyota\",\n  \"model\": \"Hiace\",\n  \"yearOfManufacture\": 2020,\n  \"plateNumber\": \"CAR-1234\",\n  \"maxWeightKg\": 1500.0,\n  \"maxVolumeM3\": 10.5,\n  \"vehiclePhotos\": []\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/vehicles",
              "host": ["{{baseUrl}}"],
              "path": ["api", "vehicles"]
            }
          }
        },
        {
          "name": "16. Get Vehicle by ID",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/vehicles/{{vehicleId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "vehicles", "{{vehicleId}}"]
            },
            "description": "Replace {{vehicleId}} with actual vehicle ID"
          }
        },
        {
          "name": "17. Get Vehicle by Plate Number",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/vehicles/plate/CAR-1234",
              "host": ["{{baseUrl}}"],
              "path": ["api", "vehicles", "plate", "CAR-1234"]
            }
          }
        }
      ]
    },
    {
      "name": "Parcel Requests & Bids",
      "item": [
        {
          "name": "18. Create Parcel Request",
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customerId\": \"{{customerId}}\",\n  \"pickupLat\": 6.9271,\n  \"pickupLng\": 79.8612,\n  \"dropoffLat\": 7.2906,\n  \"dropoffLng\": 80.6337,\n  \"weightKg\": 25.5,\n  \"volumeM3\": 2.0,\n  \"description\": \"Electronics package delivery from Colombo to Kandy\",\n  \"maxBudget\": 3500.00,\n  \"deadline\": \"2025-07-10T18:00:00+05:30\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/parcel-requests",
              "host": ["{{baseUrl}}"],
              "path": ["api", "parcel-requests"]
            }
          }
        },
        {
          "name": "19. Get All Bids",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/bids",
              "host": ["{{baseUrl}}"],
              "path": ["bids"]
            }
          }
        },
        {
          "name": "20. Get Bid by ID",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/bids/722d67db-97b3-4258-84b5-944b6a780125",
              "host": ["{{baseUrl}}"],
              "path": ["bids", "722d67db-97b3-4258-84b5-944b6a780125"]
            },
            "description": "Test bid ID from the controller comment"
          }
        },
        {
          "name": "21. Create Bid",
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"requestId\": \"{{parcelRequestId}}\",\n  \"routeId\": \"{{routeId}}\",\n  \"startIndex\": 0,\n  \"endIndex\": 1,\n  \"offeredPrice\": 3000.00\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/bids",
              "host": ["{{baseUrl}}"],
              "path": ["bids"]
            },
            "description": "Create bid linking a parcel request to a route"
          }
        }
      ]
    },
    {
      "name": "Google Maps & Health",
      "item": [
        {
          "name": "22. Google Maps Status",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/google-maps/status",
              "host": ["{{baseUrl}}"],
              "path": ["api", "google-maps", "status"]
            },
            "description": "Check Google Maps API health and configuration"
          }
        },
        {
          "name": "20. Test Geocoding",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/google-maps/test-geocoding",
              "host": ["{{baseUrl}}"],
              "path": ["api", "google-maps", "test-geocoding"]
            },
            "description": "Test Google Maps Geocoding API"
          }
        },
        {
          "name": "21. Test Directions",
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"origin\": \"Colombo, Sri Lanka\",\n  \"destination\": \"Kandy, Sri Lanka\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/google-maps/test-directions",
              "host": ["{{baseUrl}}"],
              "path": ["api", "google-maps", "test-directions"]
            },
            "description": "Test Google Maps Directions API"
          }
        }
      ]
    },
    {
      "name": "Notifications & Admin",
      "item": [
        {
          "name": "25. Get Notifications",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/notifications",
              "host": ["{{baseUrl}}"],
              "path": ["api", "notifications"]
            }
          }
        },
        {
          "name": "26. Create Notification",
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{customerId}}\",\n  \"type\": \"BID_UPDATE\",\n  \"message\": \"Your bid has been accepted\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/notifications",
              "host": ["{{baseUrl}}"],
              "path": ["api", "notifications"]
            }
          }
        },
        {
          "name": "27. Home",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/home",
              "host": ["{{baseUrl}}"],
              "path": ["home"]
            },
            "description": "Basic home endpoint"
          }
        }
      ]
    },
    {
      "name": "üìä EARNINGS Management APIs",
      "item": [
        {
          "name": "Create Earnings (Simple)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"driverId\": \"{{driverId}}\",\n    \"bidId\": \"{{bidId}}\",\n    \"amount\": 300.00,\n    \"description\": \"Manual earnings entry\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/earnings",
              "host": ["{{baseUrl}}"],
              "path": ["api", "earnings"]
            },
            "description": "üí∞ **Create Earnings (Simple Method)**\n\nCreate earnings using simplified amount field (appFee defaults to 0)\n\n**Request Fields:**\n‚Ä¢ driverId: Driver UUID (required)\n‚Ä¢ bidId: Associated bid UUID (optional)\n‚Ä¢ amount: Total earnings amount\n‚Ä¢ description: Optional description\n\n**Test Data:**\n‚Ä¢ Use driverId: {{driverId}}\n‚Ä¢ Optional bidId: {{bidId}}\n\n**Auto-saves:** earningsId to collection variables"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Earnings created successfully\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "// Auto-extract earnings ID",
                  "if (pm.response.code === 201) {",
                  "    try {",
                  "        const responseJson = pm.response.json();",
                  "        if (responseJson.data && responseJson.data.id) {",
                  "            pm.collectionVariables.set('earningsId', responseJson.data.id);",
                  "            console.log('üìù Auto-saved earningsId:', responseJson.data.id);",
                  "        }",
                  "    } catch (e) {",
                  "        console.log('Could not extract earnings ID');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Create Earnings (Detailed)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"driverId\": \"{{driverId}}\",\n    \"bidId\": \"{{bidId}}\",\n    \"grossAmount\": 450.00,\n    \"appFee\": 45.00\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/earnings",
              "host": ["{{baseUrl}}"],
              "path": ["api", "earnings"]
            },
            "description": "üí∞ **Create Earnings (Detailed Method)**\n\nCreate earnings with detailed breakdown of gross amount and app fee\n\n**Request Fields:**\n‚Ä¢ driverId: Driver UUID (required)\n‚Ä¢ bidId: Associated bid UUID (optional)\n‚Ä¢ grossAmount: Total amount before fees\n‚Ä¢ appFee: Application/platform fee\n\n**Calculation:** netAmount = grossAmount - appFee\n\n**Example:** grossAmount: 450.00, appFee: 45.00 ‚Üí netAmount: 405.00"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Earnings created successfully\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Net amount calculated correctly\", function () {",
                  "    const responseJson = pm.response.json();",
                  "    if (responseJson.data) {",
                  "        const expected = responseJson.data.grossAmount - responseJson.data.appFee;",
                  "        pm.expect(responseJson.data.netAmount).to.equal(expected);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Earnings Summary (Dashboard KPIs)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/earnings/summary?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "earnings", "summary"],
              "query": [
                {
                  "key": "driverId",
                  "value": "{{driverId}}"
                }
              ]
            },
            "description": "üìä **Earnings Summary (Dashboard KPIs)**\n\nGet earnings summary for driver dashboard including:\n\n**KPIs Returned:**\n‚Ä¢ todayEarnings: Total earnings for today\n‚Ä¢ weeklyEarnings: Total earnings for last 7 days\n‚Ä¢ availableBalance: Earnings with AVAILABLE status\n‚Ä¢ monthlyCompletedDeliveries: Count of earnings in last 30 days\n‚Ä¢ pendingBidsCount: Number of pending bids for the driver\n‚Ä¢ Growth percentages (todayGrowthPercentage, weeklyGrowthPercentage)\n\n**Use Case:** Powers the dashboard KPI cards in Dashboard.tsx"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Summary retrieved successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Summary contains required KPIs\", function () {",
                  "    const responseJson = pm.response.json();",
                  "    if (responseJson.data) {",
                  "        pm.expect(responseJson.data).to.have.property('todayEarnings');",
                  "        pm.expect(responseJson.data).to.have.property('weeklyEarnings');",
                  "        pm.expect(responseJson.data).to.have.property('availableBalance');",
                  "        pm.expect(responseJson.data).to.have.property('monthlyCompletedDeliveries');",
                  "        pm.expect(responseJson.data).to.have.property('pendingBidsCount');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Earnings History (All)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/earnings/history?driverId={{driverId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "earnings", "history"],
              "query": [
                {
                  "key": "driverId",
                  "value": "{{driverId}}"
                }
              ]
            },
            "description": "üìã **Earnings History (All Records)**\n\nGet complete earnings history for a driver with rich details:\n\n**Response Includes:**\n‚Ä¢ Basic earnings info (amounts, status, dates)\n‚Ä¢ Customer information (firstName + lastName)\n‚Ä¢ Route details (origin/destination coordinates)\n‚Ä¢ Parcel description\n‚Ä¢ Offered price from bid\n\n**Use Case:** Powers the activity feed and earnings list in Dashboard.tsx"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"History retrieved successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"History contains earnings data\", function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('data');",
                  "    pm.expect(responseJson).to.have.property('count');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Earnings History (By Status)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/earnings/history?driverId={{driverId}}&status=PENDING",
              "host": ["{{baseUrl}}"],
              "path": ["api", "earnings", "history"],
              "query": [
                {
                  "key": "driverId",
                  "value": "{{driverId}}"
                },
                {
                  "key": "status",
                  "value": "PENDING"
                }
              ]
            },
            "description": "üîç **Earnings History (Filtered by Status)**\n\nFilter earnings history by status\n\n**Valid Status Values:**\n‚Ä¢ PENDING: Earnings awaiting processing\n‚Ä¢ AVAILABLE: Ready for withdrawal\n‚Ä¢ WITHDRAWN: Already withdrawn by driver\n\n**Use Case:** Filter earnings by status in dashboard\n\n**Test Other Statuses:** Change status query parameter to AVAILABLE or WITHDRAWN"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Filtered history retrieved successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"All results match the requested status\", function () {",
                  "    const responseJson = pm.response.json();",
                  "    const requestedStatus = pm.request.url.query.get('status');",
                  "    if (responseJson.data && responseJson.data.length > 0) {",
                  "        responseJson.data.forEach(earning => {",
                  "            pm.expect(earning.status).to.equal(requestedStatus);",
                  "        });",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Update Earnings Status",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"status\": \"AVAILABLE\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/earnings/{{earningsId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["api", "earnings", "{{earningsId}}", "status"]
            },
            "description": "üîÑ **Update Earnings Status**\n\nUpdate the status of an earnings record\n\n**Status Transitions:**\n‚Ä¢ PENDING ‚Üí AVAILABLE (Release for withdrawal)\n‚Ä¢ AVAILABLE ‚Üí WITHDRAWN (Mark as withdrawn)\n\n**Request Body:**\n‚Ä¢ status: New status value (PENDING, AVAILABLE, WITHDRAWN)\n\n**Use Case:** Admin operations, automatic status updates after delivery completion\n\n**Note:** Uses native SQL to handle PostgreSQL enum casting properly\n\n**Requirement:** Must have earningsId in collection variables (auto-set by create earnings)"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status updated successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response contains updated earnings\", function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('data');",
                  "    pm.expect(responseJson.data).to.have.property('id');",
                  "    pm.expect(responseJson.data).to.have.property('status');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Earnings by Bid ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/earnings/bid/{{bidId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "earnings", "bid", "{{bidId}}"]
            },
            "description": "üéØ **Get Earnings by Bid ID**\n\nGet earnings record associated with a specific bid\n\n**Use Cases:**\n‚Ä¢ Check if earnings have been created for a completed delivery\n‚Ä¢ Link bid completion to earnings generation\n‚Ä¢ Verify payment status for specific jobs\n\n**Test Bid ID:** Uses {{bidId}} from collection variables\n\n**Response:** Returns earnings data with customer and route information if found"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Request completed successfully\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    pm.test(\"Earnings found for bid\", function () {",
                  "        const responseJson = pm.response.json();",
                  "        pm.expect(responseJson).to.have.property('data');",
                  "        pm.expect(responseJson.data).to.have.property('bidId');",
                  "    });",
                  "} else if (pm.response.code === 404) {",
                  "    pm.test(\"No earnings found for bid (expected)\", function () {",
                  "        pm.expect(pm.response.code).to.equal(404);",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ],
      "description": "## üìä Earnings Management APIs\n\nComplete set of APIs for managing driver earnings in the RouteLead platform.\n\n### üöÄ Features:\n‚Ä¢ ‚úÖ **Create Earnings**: Both simple and detailed input formats\n‚Ä¢ ‚úÖ **Dashboard KPIs**: Summary data for driver dashboard\n‚Ä¢ ‚úÖ **Earnings History**: Complete transaction history with rich details\n‚Ä¢ ‚úÖ **Status Management**: Update earnings status (PENDING ‚Üí AVAILABLE ‚Üí WITHDRAWN)\n‚Ä¢ ‚úÖ **Bid Integration**: Link earnings to specific delivery bids\n\n### üîß Technical Notes:\n‚Ä¢ Uses native SQL queries for PostgreSQL enum compatibility\n‚Ä¢ Supports both Timestamp and Instant types\n‚Ä¢ Includes comprehensive validation and error handling\n‚Ä¢ Rich responses with customer and route information\n\n### üß™ Testing Order:\n1. **Create Earnings** (Simple or Detailed) ‚Üí Auto-saves earningsId\n2. **Get Summary** to see updated KPIs\n3. **Get History** to verify creation\n4. **Update Status** to AVAILABLE\n5. **Get Summary** again to see availableBalance change\n6. **Get by Bid ID** to verify bid-earnings link\n\n### üìã Real Test Data:\n‚Ä¢ **Driver ID:** {{driverId}} (Christan The Daddy)\n‚Ä¢ **Bid ID:** {{bidId}} (ACCEPTED, $450)\n‚Ä¢ **Earnings ID:** {{earningsId}} (Auto-populated after creation)\n\n### üí° Implementation Date:\n**July 8, 2025** - Complete backend implementation with PostgreSQL enum support and real data integration.",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// Validate earnings-specific variables",
              "const requiredVars = ['driverId', 'bidId'];",
              "let missingVars = [];",
              "",
              "requiredVars.forEach(varName => {",
              "    const value = pm.collectionVariables.get(varName);",
              "    if (!value || value.includes('your-') || value === '') {",
              "        missingVars.push(varName);",
              "    }",
              "});",
              "",
              "if (missingVars.length > 0) {",
              "    console.warn('‚ö†Ô∏è  Missing earnings variables:', missingVars.join(', '));",
              "    console.warn('Check collection variables for driverId and bidId');",
              "} else {",
              "    console.log('‚úÖ Earnings variables configured:');",
              "    console.log('Driver ID:', pm.collectionVariables.get('driverId'));",
              "    console.log('Bid ID:', pm.collectionVariables.get('bidId'));",
              "    const earningsId = pm.collectionVariables.get('earningsId');",
              "    if (earningsId) {",
              "        console.log('Earnings ID:', earningsId);",
              "    }",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "driverId",
      "value": "797c6f16-a06a-46b4-ae9f-9ded8aa4ab27",
      "type": "string",
      "description": "Real driver ID from database (Christan The Daddy)"
    },
    {
      "key": "customerId",
      "value": "7139f8e2-2411-4b90-85dc-0d520427708b",
      "type": "string",
      "description": "Real customer ID from database (Rajwjdbe Hrhehe)"
    },
    {
      "key": "routeId",
      "value": "72ca2953-8f62-40c0-b107-0c89be2e7209",
      "type": "string",
      "description": "Real route ID from database for testing PATCH operations"
    },
    {
      "key": "testRouteId",
      "value": "335965d9-24f7-44a6-b3da-f77c3c19fd6c",
      "type": "string",
      "description": "Alternative route ID for testing different scenarios"
    },
    {
      "key": "parcelRequestId",
      "value": "c4482df1-3fd6-4c58-81b1-ffc7cace3afa",
      "type": "string",
      "description": "Real parcel request ID from database"
    },
    {
      "key": "vehicleId",
      "value": "",
      "type": "string",
      "description": "Will be populated after creating a vehicle"
    },
    {
      "key": "bidId",
      "value": "722d67db-97b3-4258-84b5-944b6a780125",
      "type": "string",
      "description": "Real bid ID from database (ACCEPTED status, $450 amount)"
    },
    {
      "key": "earningsId",
      "value": "",
      "type": "string",
      "description": "Will be auto-populated after creating earnings via API"
    }
  ]
}
